---
export interface Props {
  /** Opcjonalny tytuł sekcji strony, wyświetlany nad treścią. */
  pageTitle?: string;
  /** Aktualnie aktywna ścieżka nawigacji (np. "/lists", "/account"). */
  activeRoute?: string;
  /** Na mobile: ukryj navbar i tabbar, pokaż pasek z przyciskiem wstecz do tej ścieżki (np. "/lists"). */
  mobileBackHref?: string;
}

const { pageTitle, activeRoute, mobileBackHref } = Astro.props;
const isMobileNested = Boolean(mobileBackHref);
---

<div class="flex min-h-screen flex-col bg-background text-foreground">
  <!-- Na mobile zagnieżdżony ekran: tylko strzałka wstecz + tytuł -->
  {
    isMobileNested && (
      <header class="border-b bg-background/95 backdrop-blur md:hidden" aria-label="Powrót">
        <div class="flex min-h-13 items-center gap-3 px-3 py-2">
          <a
            href={mobileBackHref}
            class="inline-flex min-h-[44px] min-w-[44px] -ml-1 items-center justify-center rounded-full text-foreground hover:bg-muted"
            aria-label="Wróć"
          >
            <svg
              aria-hidden="true"
              class="h-6 w-6"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
          </a>
          {pageTitle && <h1 class="truncate text-base font-semibold tracking-tight">{pageTitle}</h1>}
        </div>
      </header>
    )
  }

  <!-- Standardowy header: ukryty na mobile gdy zagnieżdżony ekran -->
  <header class={`border-b bg-background/80 backdrop-blur ${isMobileNested ? "hidden md:block" : ""}`}>
    <div class="mx-auto flex max-w-5xl items-center justify-between px-4 py-3 md:px-6">
      <a
        href="/lists"
        class="flex items-center gap-2 text-sm font-semibold tracking-tight text-foreground hover:text-foreground/80"
        aria-label="Przejdź do dashboardu list"
      >
        <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-primary/10 text-primary">
          SS
        </span>
        <span class="hidden sm:inline">SmartShopping</span>
      </a>

      <nav class="hidden items-center gap-4 text-sm md:flex" aria-label="Główna nawigacja">
        <a
          href="/lists"
          aria-current={activeRoute === "/lists" ? "page" : undefined}
          class={`flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-medium transition-colors ${
            activeRoute === "/lists"
              ? "bg-primary/10 text-primary"
              : "text-muted-foreground hover:bg-muted hover:text-foreground"
          }`}
        >
          <svg
            aria-hidden="true"
            class="h-4 w-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M8 6h13"></path>
            <path d="M8 12h13"></path>
            <path d="M8 18h13"></path>
            <path d="M3 6h.01"></path>
            <path d="M3 12h.01"></path>
            <path d="M3 18h.01"></path>
          </svg>
          <span>Listy</span>
        </a>

        <a
          href="/account"
          aria-current={activeRoute === "/account" ? "page" : undefined}
          class={`flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-medium transition-colors ${
            activeRoute === "/account"
              ? "bg-primary/10 text-primary"
              : "text-muted-foreground hover:bg-muted hover:text-foreground"
          }`}
        >
          <svg
            aria-hidden="true"
            class="h-4 w-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"></path>
            <path d="M4 20a8 8 0 0 1 16 0"></path>
          </svg>
          <span>Konto</span>
        </a>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div
      class={`mx-auto flex max-w-5xl flex-1 flex-col px-4 pt-4 md:px-6 md:pb-6 md:pt-6 ${
        isMobileNested ? "pb-4" : "pb-20 md:pb-6"
      }`}
    >
      {pageTitle && !isMobileNested && <h1 class="mb-4 text-xl font-semibold tracking-tight">{pageTitle}</h1>}
      {pageTitle && isMobileNested && <h1 class="sr-only">{pageTitle}</h1>}
      <slot />
    </div>
  </main>

  <nav
    class={`fixed inset-x-0 bottom-0 border-t bg-background/95 pb-safe pt-1.5 md:hidden ${isMobileNested ? "hidden" : ""}`}
    aria-label="Nawigacja dolna"
  >
    <div class="mx-auto flex max-w-5xl items-center justify-around px-4 pb-1.5">
      <a
        href="/lists"
        aria-current={activeRoute === "/lists" ? "page" : undefined}
        class={`flex flex-col items-center gap-0.5 rounded-full px-3 py-1 text-xs font-medium transition-colors ${
          activeRoute === "/lists" ? "text-primary" : "text-muted-foreground hover:bg-muted hover:text-foreground"
        }`}
      >
        <svg
          aria-hidden="true"
          class="h-5 w-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M8 6h13"></path>
          <path d="M8 12h13"></path>
          <path d="M8 18h13"></path>
          <path d="M3 6h.01"></path>
          <path d="M3 12h.01"></path>
          <path d="M3 18h.01"></path>
        </svg>
        <span>Listy</span>
      </a>

      <a
        href="/account"
        aria-current={activeRoute === "/account" ? "page" : undefined}
        class={`flex flex-col items-center gap-0.5 rounded-full px-3 py-1 text-xs font-medium transition-colors ${
          activeRoute === "/account" ? "text-primary" : "text-muted-foreground hover:bg-muted hover:text-foreground"
        }`}
      >
        <svg
          aria-hidden="true"
          class="h-5 w-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"></path>
          <path d="M4 20a8 8 0 0 1 16 0"></path>
        </svg>
        <span>Konto</span>
      </a>
    </div>
  </nav>
</div>
